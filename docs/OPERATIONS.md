# Operations

## Environment variables

### Cloudflare Pages (production)

| Variable           | Required | Description                          |
|--------------------|----------|--------------------------------------|
| `TMDB_API_KEY`     | Yes      | TMDB v3 API key                      |
| `SUPABASE_URL`     | Yes      | Supabase project URL                 |
| `SUPABASE_ANON_KEY`| Yes      | Supabase anon/public key             |

Set these in: Cloudflare Dashboard → Pages → your project → Settings → Environment variables.

### Local development (`.dev.vars`)

Create `.dev.vars` in the project root (gitignored):

```
TMDB_API_KEY=your_key_here
SUPABASE_URL=https://xxxx.supabase.co
SUPABASE_ANON_KEY=your_anon_key_here
```

## Deployment steps

1. Push to GitHub (main branch)
2. Cloudflare Pages picks up the push automatically
3. Build settings:
   - **Build command:** *(leave empty)*
   - **Build output directory:** `frontend`
   - **Root directory:** `/` (repo root)

## Supabase bootstrap

Run once in the Supabase SQL editor:

```sql
create table if not exists public.profiles (
  id uuid primary key,
  username text unique not null,
  created_at timestamptz not null default now()
);

create table if not exists public.watchlist_items (
  username text not null,
  movie_id text not null,
  created_at timestamptz not null default now(),
  primary key (username, movie_id)
);

create table if not exists public.reviews (
  id bigint generated by default as identity primary key,
  username text not null,
  movie_id text not null,
  rating numeric(2,1) not null check (rating >= 0.5 and rating <= 5.0),
  text text not null,
  watched_on date,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
```
